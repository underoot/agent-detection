<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Иноагент детекшн</title>
</head>
<body>
    <style>
        html,
        body,
        #me {
            width: 100%;
            height: 100%;
        }
        #me {
            display: flex;
            text-align: center;
            justify-content: center;
            align-items: center;
            padding: 24px;
            box-sizing: border-box;
        }

        body.ino {
            background-color: red;
        }
    </style>
    <div id="me">Загрузка...</div>
    <script>
        agents = [
            "\"Голос Америки\"",
            "\"Idel.Реалии\"",
            "Кавказ.Реалии",
            "Крым.Реалии",
            "Телеканал Настоящее Время",
            "Татаро-башкирская служба Радио Свобода (Azatliq Radiosi)",
            "Радио Свободная Европа/Радио Свобода (PCE/PC)",
            "\"Сибирь.Реалии\"",
            "\"Фактограф\"",
            "\"Север.Реалии\" ",
            "Общество с ограниченной ответственностью \"Радио Свободная Европа/Радио Свобода\"",
            "Чешское информационное агентство \"MEDIUM-ORIENT\"",
            "Пономарев Лев Александрович",
            "Савицкая Людмила Алексеевна",
            "Маркелов Сергей Евгеньевич",
            "Камалягин Денис Николаевич",
            "Апахончич Дарья Александровна",
            "Медуза",
            "Общество с ограниченной ответственностью «Первое антикоррупционное СМИ»",
            "Юридическое лицо, зарегистрированное в Королевстве Нидерландов, Stichting 2 Oktober (регистрационный номер № 69126968), являющееся администратором доменного имени интернет-ресурса «VTimes.io»",
            "Баданин Роман Сергеевич",
            "Гликин Максим Александрович",
            "Маняхин Петр Борисович",
            "Ярош Юлия Петровна",
            "Чуракова Ольга Владимировна",
            "Железнова Мария Михайловна",
            "Лукьянова Юлия Сергеевна",
            "Маетная Елизавета Витальевна",
            "Юридическое лицо «The Insider SIA», зарегистрированное в Риге, Латвийская Республика (дата регистрации 26.06.2015), являющееся администратором доменного имени интернет-издания «The Insider», https://theins.ru",
            "Рубин Михаил Аркадьевич",
            "Гройсман Софья Романовна",
            "Рождественский Илья Дмитриевич",
            "Апухтина Юлия Владимировна",
            "Постернак Алексей Евгеньевич",
            "Общество с ограниченной ответственностью Телеканал Дождь",
            "Петров Степан Юрьевич",
            "Юридическое лицо Istories fonds, зарегистрированное в Латвийской Республике (регистрационный номер 50008295751, дата регистрации 24.02.2020)",
            "Шмагун Олеся Валентиновна",
            "Мароховская Алеся Алексеевна",
            "Долинина Ирина Николаевна",
            "Шлейнов Роман Юрьевич",
            "Анин Роман Александрович",
            "Великовский Дмитрий Александрович",
            "Общество с ограниченной ответственностью «Альтаир 2021»",
            "Общество с ограниченной ответственностью «Ромашки монолит»",
            "Общество с ограниченной ответственностью «Главный редактор 2021»",
            "Общество с ограниченной ответственностью «Вега 2021»",
            "Общество с ограниченной ответственностью «Важные иноагенты»",
            "Каткова Вероника Вячеславовна",
            "Карезина Инна Павловна",
            "Кузьмина Людмила Гавриловна",
            "Костылева Полина Владимировна",
            "Лютов Александр Иванович",
            "Жилкин Владимир Владимирович",
            "Жилинский Владимир Александрович",
            "Тихонов Михаил Сергеевич",
            "Пискунов Сергей Евгеньевич",
            "Ковин Виталий Сергеевич",
            "Кильтау Екатерина Викторовна",
            "Любарев Аркадий Ефимович",
            "Гурман Юрий Альбертович",
            "Грезев Александр Викторович",
            "Важенков Артем Валерьевич",
            "Иванова София Юрьевна",
            "Пигалкин Илья Валерьевич",
            "Петров Алексей Викторович",
            "Егоров Владимир Владимирович",
            "Гусев Андрей Юрьевич",
            "Смирнов Сергей Сергеевич",
            "Верзилов Петр Юрьевич",
            "Общество с ограниченной ответственностью «ЗП»",
            "Общество с ограниченной ответственностью «Зона права»",
            "Общество с ограниченной ответственностью «ЖУРНАЛИСТ-ИНОСТРАННЫЙ АГЕНТ»",
            "Вольтская Татьяна Анатольевна",
            "Клепиковская Екатерина Дмитриевна",
            "Сотников Даниил Владимирович",
            "Захаров Андрей Вячеславович",
            "Симонов Евгений Алексеевич",
            "Сурначева Елизавета Дмитриевна",
            "Соловьева Елена Анатольевна",
            "Арапова Галина Юрьевна",
            "Перл Роман Александрович",
            "Общество с ограниченной ответственностью «МЕМО»",
            "Американская компания «Mason G.E.S. Anonymous Foundation» (США), являющаяся владельцем интернет-издания https://mnews.world/ ",
            "Компания «Stichting Bellingcat», зарегистрированная в Нидерландах (дата регистрации 11.07.2018) ",
            "Автономная некоммерческая организация по защите прав человека и информированию населения «Якутия – Наше Мнение»",
            "Общество с ограниченной ответственностью «Москоу диджитал медиа»",
            "Акционерное общество «РС-Балт»",
            "Заговора Максим Александрович",
            "Ветошкина Валерия Валерьевна",
            "Павлов Иван Юрьевич",
            "Скворцова Елена Сергеевна",
            "Оленичев Максим Владимирович",
            "Общество с ограниченной ответственностью «Как бы инагент»",
            "Кочетков Игорь Викторович",
            "Фонд развития книжной культуры «Иркутский союз библиофилов»",
            "Общество с ограниченной ответственностью «Честные выборы»",
            "Общество с ограниченной ответственностью «Нобелевский призыв»",
            "Еланчик Олег Александрович",
            "Григорьева Алина Александровна",
            "Григорьев Андрей Валерьевич",
            "Гималова Регина Эмилевна",
            "Хисамова Регина Фаритовна",
            "Гельман Марат Александрович",
            "Шендерович Виктор Анатольевич",
            "Беляев Иван Михайлович",
            "Владыкина Елена Сергеевна",
            "Бекбулатова Таисия Львовна",
            "Толоконникова Надежда Андреевна",
            "Никульшина Вероника Юрьевна",
            "Алексеев Андрей Викторович",
            "Общество с ограниченной ответственностью «Данное сообщение»",
            "Общество с ограниченной ответственностью «Номер семьдесят семь»",
            "Общество с ограниченной ответственностью «ЛПНМ»",
            "Общество с ограниченной ответственностью Издательский дом «Новая глава» ",
            "Айнбиндер Александра Александровна"
        ]
        .map(agent => {
            return agent.replace('Общество с ограниченной ответственностью', '')
        })
        .map(agent => {
            return agent.replace(/[^а-яА-Яa-zA-Z\d\s\.\-]*/g, '');
        })
        .map(agent => {
            return agent.replace(/[\.\-]/g, ' ').trim();
        })
        .flatMap(agent => {
            const surname = /^(?=(?:[a-яА-Я]*\s){2}[а-яА-Я]*)([a-яА-Я]*)\s([a-яА-Я]*).*(?:вич|вна)$/.exec(agent);
            if (surname) {
                return [agent, surname[1], `${surname[1]} ${surname[2]}`, `${surname[2]} ${surname[1]}`];
            }

            return agent;
        })
        .map(agent => {
            return agent.toLocaleLowerCase();
        });

        f_agents = [];

        async function getDeclines() {
            for (let agent of agents) {
                try {
                    const text = await fetch(`https://ws3.morpher.ru/russian/declension?s=${agent.replace(/\s/g, '%20')}`)
                        .then(r => r.text())

                    f_agents.push(...[...text.matchAll(/<[А-Я]>([^<]*)<\/[A-Я]>/g)].map(v => v[1]));
                } catch (e) {

                }
                await new Promise(r => setTimeout(r, 5000));
            }
        }
    </script>
    <script>
        var scale = 1;
        function start() {
            try {
                var SpeechRecognition = window.SpeechRecognition || webkitSpeechRecognition;;
                var rec = new SpeechRecognition();
                rec.lang = 'ru-RU';
                rec.interimResults = false;
                rec.maxAlternatives = 1;
                rec.continuous = true;
                rec.addEventListener('result', (e) => {
                    const last = e.results[e.results.length - 1][0].transcript.toLocaleLowerCase();
                    let detected = null;
                    console.log('result', last);

                    agents.forEach(agent => {
                        if (last.includes(agent)) {
                            detected = agent;
                        }
                    });

                    if (detected) {
                        const speech = new SpeechSynthesisUtterance(`${detected} признан иностранным агентом`);
                        const voice = [
                            speechSynthesis.getVoices().find(v => v.lang === 'ru-RU' && v.name.includes('Google')),
                            speechSynthesis.getVoices().find(v => v.lang === 'ru-RU')
                        ].find(Boolean);
                        console.log('use voice', voice);
                        speech.voice = voice;
                        speechSynthesis.speak(speech);

                        document.body.classList.add('ino');
                        document.querySelector('#me').innerHTML = `😱<br />${detected} признан(а) иностранным агентом`;
                        document.querySelector('#me').style.transform = `scale(${++scale})`;

                        detected = null;
                    } else {
                        document.body.classList.remove('ino');
                        document.querySelector('#me').textContent = '😅';
                    }
                });
                rec.addEventListener('start', () => {
                    document.querySelector('#me').textContent = 'Попробуй только что-нибудь сказать про иноагентов...';
                });
                rec.addEventListener('speechstart', (e) => {
                    console.log('start');
                    document.body.classList.remove('ino');
                });
                rec.addEventListener('error', (e) => {
                    document.querySelector('#me').innerHTML = e.message;
                });

                rec.start();
            } catch (e) {
                document.querySelector('#me').innerHTML = e.message;
            }
        }

        let attempt = 0;
        let max_attempts = 5;

        const idx = setInterval(() => {
            console.log('get voices');
            if (speechSynthesis.getVoices().length || ++attempt >= max_attempts) {
                console.log('voices inited');
                clearInterval(idx);
                start();
            } else {
                console.log('voices not inited');
            }
        }, 1000);
    </script>
</body>
</html>